# HAMD心理评估系统使用说明

## 📌 系统概述

本系统是一个基于语音交互的智能心理评估助手，集成了自动语音识别(ASR)、大语言模型(LLM)和语音合成(TTS)技术，提供专业的哈密尔顿抑郁量表(HAMD-17)评估服务。

**主要特点：**
- ✅ 语音交互，自然对话式评估
- ✅ 两阶段评估机制，减轻用户负担
- ✅ 智能意图识别，支持多种控制指令
- ✅ 个性化共情回应，温暖陪伴
- ✅ 自动生成详细评估报告

---

## 🎯 核心功能

### 1. 两阶段评估机制

#### 阶段1：快速筛查（7题，约3-5分钟）
**目的：** 初步判断是否需要深度评估

**题目内容（按顺序）：**
1. **抑郁情绪** - 核心症状评估
2. **兴趣丧失** - 愉快感缺失评估
3. **睡眠障碍** - 睡眠质量评估
4. **精力不足** - 精神运动性评估
5. **焦虑症状** - 焦虑程度评估
6. **躯体症状** - 身体不适评估
7. **自杀意图** - 重要风险评估（放在最后，更人性化）

**分界标准：**
- **< 7分：** 轻微或无症状 → 询问是否继续深度评估
- **≥ 7分：** 建议进入阶段2深度评估

#### 阶段2：深度评估（10题，约5-8分钟）
**目的：** 全面评估症状严重程度

**题目类别：**
- 详细的睡眠模式（睡眠中断、早醒、睡眠过多）
- 躯体症状（胃肠道、性功能、体重变化）
- 认知功能（自知力、日/夜变化）
- 其他焦虑症状

**优势：**
- ✅ 减少用户初始负担
- ✅ 高风险用户能快速识别
- ✅ 低分用户可选择退出，节省时间
- ✅ 符合临床分诊逻辑

---

## 🚀 使用流程

### 1. 启动系统
```bash
python 15.0_SenceVoice_kws_CAM++.py
```

### 2. 触发评估
说出以下任一触发词：
- "心理评估"
- "心理测试"
- "抑郁评估"
- "抑郁测试"
- "开始评估"

**示例：**
```
用户："你好小千，我想做个心理评估"
系统："好的，我将为您进行心理评估，用于了解您的心理健康状况..."
```

### 3. 回答问题
系统会逐一提问，用户按实际情况回答。

**示例对话：**
```
系统："您最近几天有没有觉得心情低落、悲伤、绝望或失去兴趣？请结合最近一周的感受简单说说。"
用户："最近确实心情不太好，经常感到悲伤"
系统："我理解，这很不容易。"（共情回应）
```

### 4. 阶段转换决策
完成阶段1后，系统会询问是否继续：

**高分用户（≥7分）：**
```
系统："根据快速筛查结果，您的初步评分为X分。为了更准确地了解您的情况，我建议进行更详细的评估。您愿意继续吗？"
```

**低分用户（<7分）：**
```
系统："根据快速筛查结果，您的初步评分为X分，表现良好。如果您愿意，我们也可以进行更全面的评估。您是否要继续？"
```

**可用回答：**
- 同意继续："是"、"好"、"继续"、"可以"、"开始吧"、"那就开始"、"没问题"等
- 拒绝："不用"、"不要"、"算了"、"结束"、"跳过"等

### 5. 完成评估
系统会根据评估结果给出人性化的反馈和建议。

---

## 🎮 控制指令

在评估过程中，支持以下控制指令：

| 指令 | 功能 | 示例 |
|-----|------|------|
| **重复** | 重复当前问题 | "再说一遍"、"重复一下" |
| **上一题** | 返回上一题 | "上一题"、"回到上一个问题" |
| **跳过** | 跳过当前题 | "跳过"、"下一题" |
| **重新开始** | 从头开始评估 | "重新开始"、"重来" |
| **结束评估** | 提前结束 | "结束评估"、"停止" |
| **暂停** | 暂停评估，切换话题 | "我们聊点别的" |

---

## 📊 评估结果

### 评分标准（HAMD-17）
- **0-7分：** 正常，无明显抑郁症状
- **8-17分：** 轻度抑郁
- **18-23分：** 中度抑郁
- **24分以上：** 重度抑郁

### 结果播报
系统会根据不同评估结果给出人性化的播报：

#### 正常（0-7分）
```
"感谢您的配合，评估已经完成了。从测评结果来看，您目前的心理状态整体比较稳定，没有明显的抑郁症状。继续保持积极乐观的心态，注意劳逸结合。如果将来遇到困扰，随时可以找我聊聊。"
```

#### 轻度抑郁（8-17分）
```
"评估完成了，谢谢您的真诚回答。从结果来看，您可能正在经历一些轻度的情绪困扰。这是可以理解的，生活中难免会有起起伏伏。建议您可以多和亲友交流，保持规律作息，适当运动放松。如果情况持续或加重，建议寻求专业心理咨询师的帮助。"
```

#### 中度抑郁（18-23分）
```
"评估已经完成，非常感谢您的信任和配合。测评显示您目前可能承受着较大的心理压力。我理解这段时间对您来说可能很不容易。建议您尽快寻求专业的心理咨询或医疗帮助，专业人士可以为您提供更有针对性的支持和治疗方案。同时，也请多关注自己的身心健康，不要独自承受。"
```

#### 重度抑郁（24分以上）
```
"评估已经完成，感谢您愿意和我分享这些。测评结果表明您当前的状况需要得到专业关注。我非常理解您现在可能正经历着很大的困难，这不是您的错。请您尽快联系专业的心理医生或前往医院的心理科就诊，寻求专业的医疗帮助。您并不孤单，有很多人和资源可以帮助您。请照顾好自己，您值得被关心和帮助。"
```

### 评估报告
系统会自动生成详细的JSON格式评估报告，保存在 `./HAMD_Results/` 目录下。

**报告内容包括：**
- 评估ID和时间戳
- 总分和严重程度
- 每题详细评分和分析
- 分类症状分析
- 个性化建议

---

## 🔧 技术架构

### 核心组件
1. **语音识别（ASR）：** SenseVoice - 实时语音转文字
2. **大语言模型（LLM）：** QWen2.5 - 智能对话和评分
3. **语音合成（TTS）：** Edge-TTS - 自然语音播报
4. **唤醒词检测（KWS）：** 关键词触发
5. **评估引擎：** HAMDEvaluator - 两阶段评估逻辑

### 主要文件
- `15.0_SenceVoice_kws_CAM++.py` - 主程序，集成所有功能
- `hamd_evaluator.py` - HAMD评估核心逻辑
- `hamd_questions.json` - 题目配置和评分标准

---

## ⚙️ 配置说明

### 唤醒词设置
```python
set_KWS = "ni hao xiao qian"  # 默认唤醒词："你好小千"
flag_KWS_used = 1  # 1=启用唤醒词，0=关闭唤醒词
```

### TTS音色设置
```python
DEFAULT_TTS_VOICE = "zh-CN-XiaoyiNeural"  # 默认中文女声
VOICE_LOCK_ENABLED = True  # True=锁定音色，False=根据语种切换
```

### 评估参数
```python
# 阶段1题目列表（可自定义顺序）
self.stage1_questions = [1, 6, 4, 8, 9, 13, 3]

# 阶段转换分数阈值
self.stage1_threshold = 7

# 等待用户回答时的停顿时间
ANSWER_PAUSE_SECONDS = 3.5
```

---

## 🛡️ 注意事项

### 医疗免责声明
⚠️ **重要：** 本系统仅供心理健康筛查参考，不能替代专业医疗诊断。如有严重心理问题，请及时寻求专业医疗帮助。

### 使用建议
1. **环境要求：** 安静环境，减少背景噪音
2. **回答建议：** 结合最近一周的真实感受回答
3. **隐私保护：** 评估记录仅保存在本地
4. **专业咨询：** 中度及以上抑郁建议寻求专业帮助

### 技术要求
- Python 3.8+
- CUDA支持的GPU（推荐）
- 麦克风设备
- 网络连接（用于LLM推理）

---

## 📞 支持与反馈

如遇到技术问题或有功能建议，欢迎反馈。

---

## 📝 更新日志

### v2.0 (当前版本)
- ✅ 实现两阶段评估机制
- ✅ 优化题目顺序（自杀意图题放在阶段1最后）
- ✅ 增强阶段转换决策识别灵敏度
- ✅ 优化评估结束播报话语，更加人性化
- ✅ 移除声纹识别功能
- ✅ 移除跳题功能

### v1.0
- ✅ 基础HAMD-17评估功能
- ✅ 语音交互界面
- ✅ 自动评分和报告生成

---

**祝您使用愉快！关注心理健康，从每一次对话开始。** 💙

